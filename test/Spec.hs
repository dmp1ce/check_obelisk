import CheckObelisk
import Test.Tasty ( defaultMain, TestTree, testGroup )
import Test.Tasty.HUnit ( testCase, (@?=) )
import qualified Data.ByteString.Lazy as LB

main :: IO ()
main = defaultMain tests

tests :: TestTree
tests = testGroup "Tests" [json]

json :: TestTree
json = testGroup "json tests"
  [ testCase "get temperature from example dashboard response body" $
    getExhaustTemp dashboardExample @?= [(65.8 :: Rational), 63.8]
  ]

dashboardExample :: LB.ByteString
dashboardExample = "{\"systemInfo\":[{\"value\":\"SC1 Slim\",\"name\":\"Model\"},{\"value\":\"v1.2.0\",\"name\":\"Software Version\"},{\"value\":\"45 MB\",\"name\":\"Free Memory\"},{\"value\":\"109 MB\",\"name\":\"Total Memory\"},{\"value\":\"1 day, 01:06 (HH:MM)\",\"name\":\"Uptime\"},{\"value\":\"4000.0\",\"name\":\"Pool Difficulty\"},{\"value\":\"61%\",\"name\":\"Fan Speed\"}],\"poolStatus\":[{\"accepted\":5361,\"status\":\"Alive\",\"rejected\":51,\"url\":\"stratum+tcp://sc-us.luxor.tech:3333\",\"worker\":\"0eb8180145d1f0b2b6e88cedf5bc42e97969122ffdab4a68510ab286caee4d2fd464f152bab4.MP-SC1-135\"}],\"hashboardStatus\":[{\"exhaustTemp\":\"65.8\",\"performanceNumber\":\"2300\",\"firmwareVersion\":\"3.19\",\"isTuning\":false,\"current\":\"38.7\",\"hashrate5min\":\"518.3\",\"hashrate1min\":\"514.4\",\"intakeTemp\":\"43.5\",\"hashrate15min\":\"520.3\",\"exhaustTempSetpoint\":\"65.0\",\"status\":\"Alive\",\"voltage\":\"10.3\"},{\"exhaustTemp\":\"63.8\",\"performanceNumber\":\"2250\",\"firmwareVersion\":\"3.19\",\"isTuning\":false,\"current\":\"37.6\",\"hashrate5min\":\"540.4\",\"hashrate1min\":\"538.4\",\"intakeTemp\":\"41.7\",\"hashrate15min\":\"540.6\",\"exhaustTempSetpoint\":\"65.0\",\"status\":\"Alive\",\"voltage\":\"10.3\"}],\"hashrateData\":[{\"time\":1556030747,\"Total\":1058,\"Board 1\":520,\"Board 2\":538},{\"time\":1556030808,\"Total\":1057,\"Board 1\":518,\"Board 2\":539},{\"time\":1556030868,\"Total\":1057,\"Board 1\":516,\"Board 2\":541},{\"time\":1556030928,\"Total\":1060,\"Board 1\":518,\"Board 2\":542},{\"time\":1556030988,\"Total\":1061,\"Board 1\":520,\"Board 2\":541},{\"time\":1556031048,\"Total\":1061,\"Board 1\":521,\"Board 2\":540},{\"time\":1556031108,\"Total\":1062,\"Board 1\":521,\"Board 2\":541},{\"time\":1556031168,\"Total\":1060,\"Board 1\":519,\"Board 2\":541},{\"time\":1556031228,\"Total\":1062,\"Board 1\":520,\"Board 2\":542},{\"time\":1556031288,\"Total\":1063,\"Board 1\":521,\"Board 2\":542},{\"time\":1556031348,\"Total\":1064,\"Board 1\":522,\"Board 2\":542},{\"time\":1556031408,\"Total\":1062,\"Board 1\":521,\"Board 2\":541},{\"time\":1556031468,\"Total\":1062,\"Board 1\":521,\"Board 2\":541},{\"time\":1556031528,\"Total\":1066,\"Board 1\":523,\"Board 2\":543},{\"time\":1556031588,\"Total\":1065,\"Board 1\":522,\"Board 2\":543},{\"time\":1556031648,\"Total\":1065,\"Board 1\":522,\"Board 2\":543},{\"time\":1556031708,\"Total\":1066,\"Board 1\":522,\"Board 2\":544},{\"time\":1556031768,\"Total\":1064,\"Board 1\":520,\"Board 2\":544},{\"time\":1556031828,\"Total\":1065,\"Board 1\":520,\"Board 2\":545},{\"time\":1556031888,\"Total\":1065,\"Board 1\":520,\"Board 2\":545},{\"time\":1556031948,\"Total\":1067,\"Board 1\":524,\"Board 2\":543},{\"time\":1556032008,\"Total\":1067,\"Board 1\":525,\"Board 2\":542},{\"time\":1556032068,\"Total\":1064,\"Board 1\":524,\"Board 2\":540},{\"time\":1556032128,\"Total\":1062,\"Board 1\":522,\"Board 2\":540},{\"time\":1556032188,\"Total\":1056,\"Board 1\":519,\"Board 2\":537},{\"time\":1556032248,\"Total\":1055,\"Board 1\":519,\"Board 2\":536},{\"time\":1556032308,\"Total\":1058,\"Board 1\":520,\"Board 2\":538},{\"time\":1556032368,\"Total\":1058,\"Board 1\":520,\"Board 2\":538},{\"time\":1556032428,\"Total\":1058,\"Board 1\":519,\"Board 2\":539},{\"time\":1556032488,\"Total\":1058,\"Board 1\":520,\"Board 2\":538},{\"time\":1556032548,\"Total\":1059,\"Board 1\":521,\"Board 2\":538},{\"time\":1556032608,\"Total\":1062,\"Board 1\":523,\"Board 2\":539},{\"time\":1556032668,\"Total\":1064,\"Board 1\":526,\"Board 2\":538},{\"time\":1556032728,\"Total\":1062,\"Board 1\":524,\"Board 2\":538},{\"time\":1556032788,\"Total\":1063,\"Board 1\":524,\"Board 2\":539},{\"time\":1556032848,\"Total\":1063,\"Board 1\":523,\"Board 2\":540},{\"time\":1556032908,\"Total\":1062,\"Board 1\":521,\"Board 2\":541},{\"time\":1556032968,\"Total\":1059,\"Board 1\":520,\"Board 2\":539},{\"time\":1556033028,\"Total\":1058,\"Board 1\":521,\"Board 2\":537},{\"time\":1556033088,\"Total\":1061,\"Board 1\":522,\"Board 2\":539},{\"time\":1556033148,\"Total\":1060,\"Board 1\":520,\"Board 2\":540},{\"time\":1556033208,\"Total\":1062,\"Board 1\":522,\"Board 2\":540},{\"time\":1556033268,\"Total\":1063,\"Board 1\":522,\"Board 2\":541},{\"time\":1556033328,\"Total\":1061,\"Board 1\":522,\"Board 2\":539},{\"time\":1556033388,\"Total\":1064,\"Board 1\":525,\"Board 2\":539},{\"time\":1556033448,\"Total\":1062,\"Board 1\":524,\"Board 2\":538},{\"time\":1556033508,\"Total\":1058,\"Board 1\":521,\"Board 2\":537},{\"time\":1556033568,\"Total\":1056,\"Board 1\":520,\"Board 2\":536},{\"time\":1556033628,\"Total\":1058,\"Board 1\":522,\"Board 2\":536},{\"time\":1556033688,\"Total\":1056,\"Board 1\":520,\"Board 2\":536},{\"time\":1556033748,\"Total\":1057,\"Board 1\":520,\"Board 2\":537},{\"time\":1556033808,\"Total\":1060,\"Board 1\":521,\"Board 2\":539},{\"time\":1556033868,\"Total\":1062,\"Board 1\":520,\"Board 2\":542},{\"time\":1556033928,\"Total\":1063,\"Board 1\":521,\"Board 2\":542},{\"time\":1556033988,\"Total\":1063,\"Board 1\":519,\"Board 2\":544},{\"time\":1556034049,\"Total\":1063,\"Board 1\":520,\"Board 2\":543},{\"time\":1556034109,\"Total\":1065,\"Board 1\":521,\"Board 2\":544},{\"time\":1556034169,\"Total\":1065,\"Board 1\":521,\"Board 2\":544},{\"time\":1556034229,\"Total\":1063,\"Board 1\":519,\"Board 2\":544},{\"time\":1556034289,\"Total\":1058,\"Board 1\":519,\"Board 2\":539}]}"
